<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ItemListMapper">

   <!-- Beans의 멤버변수(property) 이름과 대상 테이블의 컬럼(column)을 연결한다. -->
   <resultMap type="study.shop.cidermarket.model.Product" id="ItemListMap">
      <result property="prodno" column="prodno" />
      <result property="cateno" column="cateno" />
      <result property="subject" column="subject" />
      <result property="price" column="price" />
      <result property="fee" column="fee" />
      <result property="detail" column="detail" />
      <result property="regdate" column="regdate" />
      <result property="prodcon" column="prodcon" />
      <result property="how" column="how" />
      <result property="tradecon" column="tradecon" />
      <result property="seller" column="seller" />
      <result property="hits" column="hits" />
      <result property="editdate" column="editdate" />
      <result property="filepath" column="filepath" />
   </resultMap>
   
   <!-- 단일행 조회를 위한 기능 정의 -->
   <select id="selectItemByFilter"
      parameterType="study.shop.cidermarket.model.Product"
      resultMap="ItemListMap">
      SELECT 
         (SELECT filepath FROM files WHERE fileno=(SELECT MIN(fileno) FROM files WHERE refid=prodno AND reftable='product')) AS filepath,
         subject, price,prodno
      FROM product
      WHERE prodcon=#{prodcon} and how={how}
      
      order by regdate Desc
      <if test="listCount > 0">
         LIMIT #{offset}, #{listCount}
      </if>
   </select>
   
   <!-- 다중행 조회를 위한 기능 정의 -->
   <select id="selectList"
      parameterType="study.shop.cidermarket.model.Product"
      resultMap="ItemListMap">
      SELECT 
         (SELECT filepath FROM files WHERE fileno=(SELECT MIN(fileno) FROM files WHERE refid=prodno AND reftable='product')) AS filepath,
         subject, price,prodno
      FROM product
      
      order by regdate Desc
      
      <if test="listCount > 0">
         LIMIT #{offset}, #{listCount}
      </if>
      
   </select>   
   
   <select id="selectListByPriceAsc"
      parameterType="study.shop.cidermarket.model.Product"
      resultMap="ItemListMap">
      SELECT 
         (SELECT filepath FROM files WHERE fileno=(SELECT MIN(fileno) FROM files WHERE refid=prodno AND reftable='product')) AS filepath,
         subject, price,prodno
      FROM product
      
      ORDER BY price Asc
      
      <if test="listCount > 0">
         LIMIT #{offset}, #{listCount}
      </if>
   </select>
   
      <select id="selectListByPriceDesc"
      parameterType="study.shop.cidermarket.model.Product"
      resultMap="ItemListMap">
      SELECT 
         (SELECT filepath FROM files WHERE fileno=(SELECT MIN(fileno) FROM files WHERE refid=prodno AND reftable='product')) AS filepath,
         subject, price,prodno
      FROM product
      
      ORDER BY price DESC
      
      <if test="listCount > 0">
         LIMIT #{offset}, #{listCount}
      </if>
   </select>
   
   <select id="selectListByRegdate"
      parameterType="study.shop.cidermarket.model.Product"
      resultMap="ItemListMap">
      SELECT 
         (SELECT filepath FROM files WHERE fileno=(SELECT MIN(fileno) FROM files WHERE refid=prodno AND reftable='product')) AS filepath,
         subject, price,prodno
      FROM product
      
      ORDER BY regdate DESC
      
      <if test="listCount > 0">
         LIMIT #{offset}, #{listCount}
      </if>
   </select>
   
   <!-- 데이터 수 조회를 위한 기능 정의 -->
   <select id="selectCountAll"
      parameterType="study.shop.cidermarket.model.Product"
      resultType="int">
      SELECT COUNT(*) FROM Product
      
      <where>
         <if test="subject != null and subject != ''">
            subject LIKE concat('%', #{subject}, '%')
         </if>
      </where>
   </select>
   
   
      <!-- 필터 다중행 조회를 위한 기능 정의 -->
   
   <!-- 카테고리별로 불러오기 -->
   <select id="selectListByCategory"
      parameterType="study.shop.cidermarket.model.Product"
      resultMap="ItemListMap">
      SELECT 
         (SELECT filepath FROM files WHERE fileno=(SELECT MIN(fileno) FROM files WHERE refid=prodno AND reftable='product')) AS filepath,
         subject, price,prodno
      FROM product
      WHERE cateno=#{cateno}
      <if test="prodno != null and prodno != ''">
      AND prodno!=#{prodno}
      </if>
      ORDER BY regdate DESC
      
      <if test="listCount > 0">
         LIMIT #{offset}, #{listCount}
      </if>
   </select>
   
   <!-- 판매자별로 불러오기 -->
   <select id="selectListBySeller"
      parameterType="study.shop.cidermarket.model.Product"
      resultMap="ItemListMap">
      SELECT 
         (SELECT filepath FROM files WHERE fileno=(SELECT MIN(fileno) FROM files WHERE refid=prodno AND reftable='product')) AS filepath,
         subject, price,prodno
      FROM product
      WHERE seller=#{seller}
      <if test="prodno != null and prodno != ''">
      AND prodno!=#{prodno}
      </if>
      ORDER BY regdate DESC
      
      <if test="listCount > 0">
         LIMIT #{offset}, #{listCount}
      </if>
   </select>

</mapper>